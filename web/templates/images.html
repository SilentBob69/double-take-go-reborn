<!DOCTYPE html>
<html lang="de" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} - Double Take</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .image-card {
            transition: all 0.3s ease;
            height: 100%;
        }
        .image-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .image-thumbnail {
            height: 200px;
            object-fit: cover;
            width: 100%;
        }
        .filter-bar {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    {{template "_navbar.html" .}}

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Bilder</h1>
            <span class="badge bg-primary fs-5">{{ .Pagination.Total }} Ergebnisse</span>
        </div>

        <div class="filter-bar">
            <form method="GET" action="/images" class="row g-3">
                <div class="col-md-3">
                    <label for="source" class="form-label">Quelle</label>
                    <select name="source" id="source" class="form-select">
                        <option value="">Alle</option>
                        <option value="frigate" {{ if eq .Filter.Source "frigate" }}selected{{ end }}>Frigate</option>
                        <option value="upload" {{ if eq .Filter.Source "upload" }}selected{{ end }}>Upload</option>
                        <option value="webhook" {{ if eq .Filter.Source "webhook" }}selected{{ end }}>Webhook</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="hasfaces" class="form-label">Gesichter</label>
                    <select name="hasfaces" id="hasfaces" class="form-select">
                        <option value="">Alle</option>
                        <option value="yes">Mit Gesichtern</option>
                        <option value="no">Ohne Gesichter</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="hasmatches" class="form-label">Matches</label>
                    <select name="hasmatches" id="hasmatches" class="form-select">
                        <option value="">Alle</option>
                        <option value="yes">Mit erkannten Identitäten</option>
                        <option value="no">Ohne Identitäten</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="daterange" class="form-label">Zeitraum</label>
                    <select name="daterange" id="daterange" class="form-select">
                        <option value="">Alle</option>
                        <option value="today">Heute</option>
                        <option value="yesterday">Gestern</option>
                        <option value="week">Letzte Woche</option>
                        <option value="month">Letzter Monat</option>
                    </select>
                </div>
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-filter"></i> Filtern
                    </button>
                    <a href="/images" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Zurücksetzen
                    </a>
                </div>
            </form>
        </div>

        <div class="row mb-4" data-image-container data-sse-updates>
            {{ if .Images }}
                {{ range .Images }}
                <div class="col-md-3 mb-4">
                    <div class="card image-card">
                        <a href="/images/{{ .ID }}">
                            <img src="/snapshots/{{ .FilePath }}" class="image-thumbnail" alt="Bild">
                        </a>
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <h6 class="card-title">{{ .Source }}</h6>
                                <small class="text-muted">{{ formatTime .DetectedAt }}</small>
                            </div>
                            <div class="mt-2">
                                <span class="badge bg-info">Gesicht erkannt</span>
                                <span class="badge bg-success">Identitäten erkannt</span>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            {{ else }}
                <div class="col-12 text-center py-5">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Keine Bilder gefunden</h5>
                            <p class="card-text">Mit den aktuellen Filtereinstellungen wurden keine Bilder gefunden.</p>
                        </div>
                    </div>
                </div>
            {{ end }}
        </div>

        <!-- Pagination -->
        {{ if gt .Pagination.TotalPages 1 }}
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item {{ if eq .Pagination.Current 1 }}disabled{{ end }}">
                    <a class="page-link" href="/images?page={{ subtract .Pagination.Current 1 }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                
                {{ range $i := paginationRange .Pagination.Current .Pagination.TotalPages }}
                <li class="page-item {{ if eq $i $.Pagination.Current }}active{{ end }}">
                    <a class="page-link" href="/images?page={{ $i }}">{{ $i }}</a>
                </li>
                {{ end }}
                
                <li class="page-item {{ if eq .Pagination.Current .Pagination.TotalPages }}disabled{{ end }}">
                    <a class="page-link" href="/images?page={{ add .Pagination.Current 1 }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
        {{ end }}
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <footer class="bg-light mt-5 py-3">
        <div class="container text-center">
            <p class="mb-0 text-muted">Double-Take Go &copy; 2025</p>
        </div>
    </footer>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toast-Benachrichtigungen anstelle von alert()
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                const container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(container);
            }
            
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.id = toastId;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            let bgClass = 'bg-primary';
            let iconClass = 'bi-info-circle';
            if (type === 'success') {
                bgClass = 'bg-success';
                iconClass = 'bi-check-circle';
            } else if (type === 'error') {
                bgClass = 'bg-danger';
                iconClass = 'bi-exclamation-circle';
            } else if (type === 'warning') {
                bgClass = 'bg-warning';
                iconClass = 'bi-exclamation-triangle';
            }
            
            toast.innerHTML = `
                <div class="toast-header ${bgClass} text-white">
                    <i class="bi ${iconClass} me-2"></i>
                    <strong class="me-auto">${title}</strong>
                    <small>jetzt</small>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            const toastInstance = new bootstrap.Toast(document.getElementById(toastId));
            toastInstance.show();
            
            // Automatisch entfernen nach dem Schließen
            document.getElementById(toastId).addEventListener('hidden.bs.toast', function () {
                this.remove();
            });
        }
    </script>
</body>
</html>
